# AI時代の爆速開発「バイブコーディング」を、Rustの物理的ガードレールで無敵にする

## はじめに
直感とAIの推論を駆使して、思考の速度でコードを書き進めるスタイル —— **「バイブコーディング（Vibe Coding）」**。
この爆発的な創造性は快感ですが、一方で「速度優先でセキュリティが疎かになる」という負債を抱えがちです。

AIが生成したプロンプト処理に脆弱性があったら？
深く考えずに通したパスが、トラバーサル攻撃可能だったら？

この課題を解決するために、**Bastion (バスティオン)** というセキュリティツールキットを開発しました。

## Bastion とは？
Bastionは、バイブコーディングの「勢い（Vibe）」を殺さず、背後で「産業グレードの物理的なガードレール」を構築する Rust 製ツールです。

「気をつける」という人間の曖昧な意志ではなく、Rust の厳格な型システムと独自の実装により、物理的に脆弱性を排除することを目指しています。

## 技術的な深掘り：いかにして「物理的」に守るか

Bastion が提供する各モジュールには、産業グレードの攻撃耐性を持たせるための独自の工夫が凝らされています。

### 1. 🏰 File Jail (`fs_guard`)：パス・トラバーサルとの決別
多くのツールは正規表現などでパスをチェックしますが、これでは不十分です。Bastion の `fs_guard` は以下のステップで検証します。

- **標準化 (Canonicalization)**: `../` やシンボリックリンクが含まれるパスを、OSレベルで絶対パスに解決します。
- **プレフィックス検証**: 解決されたパスが、許可されたベースディレクトリの配下にあるかを `starts_with` で厳格にチェックします。
- **TOCTOU 対策**: 将来的には、検証時と使用時の時間差を突く攻撃を防ぐため、開いたファイル記述子 (`fd`) に対して操作を行う物理的な制約を強化予定です。

### 2. 🌐 Net Shield (`net_guard`)：DNS Rebinding を根本から絶つ
SSRF 対策で最も難しいのが DNS Rebinding です。攻撃者は検証時に安全な IP を返し、通信の瞬間にローカル IP へ解決先を差し替えます。

Bastion はこれを **「IP直接指定方式」** で解決しました。
1. `trust-dns-resolver` を使用し、自前で名前解決を強制します。
2. 解決された IP アドレスがプライベート範囲でないか検証します。
3. **重要**: 検証した IP アドレスをそのまま URL のホスト部に書き換え（例: `http://1.2.3.4/path`）、元のホスト名は `Host` ヘッダーにのみセットして通信します。
これにより、OSやライブラリによる「再名前解決」の隙を 1 ミリも与えません。

### 3. 🛡️ Analyzer & Sanitizer (`text_guard`)：不可視の攻撃を炙り出す
プロンプトインジェクションや DoS 攻撃は巧妙です。
- **Unicode Bidi 検知**: `LRI` や `RLO` といった、テキストの方向を逆転させてコードの意味を書き換える不可視の制御文字を検出し、無害化します。
- **DoS 保護**: 巨大な入力によるリソース枯渇を防ぐため、型レベルで最大長を保証し、過剰な解析を行わない設計になっています。
- **Rust の型システム**: 検証結果を `ValidationResult` 型で返し、開発者が必ずエラーハンドリングを強制されるように仕向けます。

## 使い方

## なぜ Rust なのか？
バイブコーディングにおいて、Rustは「至高のパートナー」です。
F1レーサーがブレーキを信頼しているからこそアクセルを全開にできるのと同じで、開発者は Rust のコンパイラを「潜在意識下の監査役」として信頼することで、限界までバイブスを加速させることができます。

## 使い方

プロジェクトのルートで 1 コマンド実行するだけです。

```bash
cargo install bastion-toolkit
bastion init
```

これだけで、あなたのプロジェクトにガードレールが展開されます。

## おわりに
Bastion 自体も 100% バイブコーディングによって開発されました。
このツールが、世界中の開発者の挑戦を加速させ、より安全な「バイブス」を生み出す助けになれば幸いです。

- **GitHub**: [for4xex-droid/bastion](https://github.com/for4xex-droid/bastion)
- **Philosophy**: [PHILOSOPHY.md](https://github.com/for4xex-droid/bastion/blob/master/PHILOSOPHY.md)

**Build fast, stay safe.** 🏰🦀
